<!--作者：莫岭红 功能：新建（编辑）学术参与-->
<template>
  <div v-wechat-title="title" class="newLearn">
    <div class="dy-top">
      <x-header class="x-header" slot="header" :left-options="{backText: ''}">{{title}}<a slot="right"
                                                                                          @click="goEssentialInfo()">完成</a>
      </x-header>
    </div>
    <div class="cellBox"></div>
    <div class="backgroundStyle">
      <datetime v-model="academicJoinDto.academicDate" title="日期" placeholder="请选择" :is-type="codeValue" required></datetime>
      <div-selector :tilteValue="'活动类型'" :dictCode="'CH'"
          v-on:listenSelect="(value) => {academicJoinDto.academicActivityType = value.code}"
          :anyData="academicJoinDto.academicActivityType" :is-type="codeValue" required></div-selector>
      <x-input title="活动名称" v-model="academicJoinDto.activityName" placeholder="请填写" text-align="right" :is-type="codeValue" required></x-input>
      <div-selector :tilteValue="'参与角色'" :dictCode="'SSJS'"
                    v-on:listenSelect="(value) => {academicJoinDto.participantRoles = value.code}"
                    :anyData="academicJoinDto.participantRoles" :is-type="codeValue" required></div-selector>
    </div>
  </div>
</template>
<script>
  export default {
    name: 'NewLearning',
    data () {
      return {
        codeValue: function (value) {
          return {
            valid: value !== '' || null,
          }
        },
        title: '新建学术参与',
        academicJoinDto: {
          customerId: '',//所属客户
          academicDate: '',//日期
          academicActivityType: '',//学术活动类型
          activityName: '',//活动名称
          participantRoles: ''//参与角色
        }

      }
    },
    created () {
      this.title = this.$route.params.title || this.$route.meta.title
      this.academicJoinDto.customerId = this.$route.params.id
      if (this.$route.params.data) {
        this.academicJoinDto.academicDate = this.$route.params.data.academicDate
        this.academicJoinDto.activityName = this.$route.params.data.activityName
        this.academicJoinDto.academicActivityType = this.$route.params.data.academicActivityType
        this.academicJoinDto.participantRoles = this.$route.params.data.participantRoles
        this.academicJoinDto['id'] = this.$route.params.data.id
      }
    },
    methods: {
      goEssentialInfo () {
        for(let key in this.academicJoinDto) {
          switch (key) {
            case 'academicDate':
              if(this.academicJoinDto[key] === '' || null) {this.$vux.toast.text('日期不能为空', 'middle'); return;}
              break
            case 'academicActivityType':
              if(this.academicJoinDto[key] === '' || null) {this.$vux.toast.text('学术活动类型不能为空', 'middle'); return;}
              break
            case 'activityName':
              if(this.academicJoinDto[key] === '' || null) {this.$vux.toast.text('活动名称不能为空', 'middle'); return;}
              break
            case 'participantRoles':
              if(this.academicJoinDto[key] === '' || null) {this.$vux.toast.text('参与角色不能为空', 'middle'); return;}
              break
          }
        }
        if (this.title === '编辑学术参与') {
          this.$put('/api/AcademicJoin', this.academicJoinDto).then(info => {
            this.$vux.toast.text('编辑学术参与成功', 'middle')
            this.$router.push(`/userInfo/${this.academicJoinDto.customerId }/follow-details/${this.academicJoinDto.customerId }`)
          }).catch(error => {
            this.$vux.toast.text('编辑学术参与失败', 'middle')
          })
        } else if (this.title === '新建学术参与') {
          this.$post('/api/AcademicJoin', this.academicJoinDto).then(info => {
            this.$vux.toast.text('新建学术参与成功', 'middle')
            this.$router.push(`/userInfo/${this.academicJoinDto.customerId }/follow-details/${this.academicJoinDto.customerId }`)
          }).catch(error => {
            this.$vux.toast.text('新建学术参与失败', 'middle')
          })
        }
      }
    },
    beforeRouteLeave (to, from, next) {
      if (!to.params.id) {
        to.params.title = '全部学术参与信息'
        to.params.id = this.academicJoinDto.customerId
      }
      next()
    },
  }
</script>


<style lang="less">
  .newLearn {
    .dy-top {
      .x-header {
        h1.vux-header-title {
          font-size: 19px;
        }
        .vux-header-right {
          font-size: 15px;
        }
      }
    }
    .cellBox {
      height: 20px;
    }
    .backgroundStyle {
      font-size: 16px;
    }
  }


</style>
