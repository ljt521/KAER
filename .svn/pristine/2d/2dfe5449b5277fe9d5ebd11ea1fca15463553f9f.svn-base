<template>
  <span>
    {{message}}
  </span>
</template>

<script>
  export default {
    name: 'DivSpan',
    props: ['dictCode', 'dictItemCode'],
    data () {
      return {
        message: ""
      }
    },
    mounted () {
      if (this.dictItemCode) {
        if (window.localStorage.getItem(this.dictCode)) {
          const dictList = JSON.parse(window.localStorage.getItem(this.dictCode));
          dictList.forEach((item) => {
            if (item.code == this.dictItemCode) {
              this.message = item.value;
            }
          })
        } else {
          this.$get('/api/customer/getDictItemList', {
            dictKey: this.dictCode,
          }).then(info => {
            window.localStorage.setItem(this.dictCode, JSON.stringify(info));
            info.forEach((item) => {
              if (item.code == this.dictItemCode) {
                this.message = item.value;
              }
            });
          }).catch(error => {
            console.log(error);
          })
          // this.$get('/api/customer/getDictItemValue', {
          //   dictKey: this.dictCode,
          //   dictItemKey: this.dictItemCode
          // }).then(info => {
          //   this.message = info;
          // }).catch(error => {
          //   console.log(error);
          // })
        }

      }
    },
    methods: {},
    watch: {
      dictItemCode () {
        if (window.localStorage.getItem(this.dictCode)) {
          const dictList = JSON.parse(window.localStorage.getItem(this.dictCode));
          dictList.forEach((item) => {
            if (item.code == this.dictItemCode) {
              this.message = item.value;
            }
          })
        } else {
          this.$get('/api/customer/getDictItemList', {
            dictKey: this.dictCode,
          }).then(info => {
            window.localStorage.setItem(this.dictCode, JSON.stringify(info));
            info.forEach((item) => {
              if (item.code == this.dictItemCode) {
                this.message = item.value;
              }
            });
          }).catch(error => {
            console.log(error);
          })
          // this.$get('/api/customer/getDictItemValue', {
          //   dictKey: this.dictCode,
          //   dictItemKey: this.dictItemCode
          // }).then(info => {
          //   this.message = info;
          // }).catch(error => {
          //   console.log(error);
          // })
        }
      }
    }
  }
</script>
